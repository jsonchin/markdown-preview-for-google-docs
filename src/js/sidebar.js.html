<script>
    const DOC_POLL_TIME = 1 * 1000; // in milliseconds
    
    var intervalId;
    $(function() {
        renderPreviewContents();
        pollAndUpdatePreview();
    });

    function renderPreviewContents() {
        google.script.run
            .withSuccessHandler(setPreviewContents)
            .withFailureHandler(displayError)
            .convertDocToMarkdown();
    }

    function pollAndUpdatePreview() {
        intervalId = setInterval(renderPreviewContents, DOC_POLL_TIME);
    }

    function setPreviewContents(docMarkdownHtml) {
        $('#gdoc-markdown').html(docMarkdownHtml);
    }

    function displayError(error) {
        setPreviewContents('Was not able to render the markdown preview.');
    }
    

</script>
